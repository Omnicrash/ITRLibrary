{% extends 'ITRLibraryBundle::layout.html.twig' %}

{% block content %}
    {% set queryData = app.request.query.all() %}
    <h1>Library</h1>

    <div class="row margin-20">
        <div class="col-lg-6">
            Sorteren op:
            <div class="btn-group sortable" role="group">
                <span class="btn btn-link{% if pagination.isSorted('p.title') %} active{% endif %}"> {{ knp_pagination_sortable(pagination, 'Titel', 'p.title') }}</span>
                <span class="btn btn-link{% if pagination.isSorted('p.writtenAt') %} active{% endif %}"> {{ knp_pagination_sortable(pagination, 'Geschreven', 'p.writtenAt') }}</span>
                <span class="btn btn-link{% if pagination.isSorted('p.createdAt') %} active{% endif %}"> {{ knp_pagination_sortable(pagination, 'Toegevoegd', 'p.createdAt') }}</span>
                <span class="btn btn-link{% if pagination.isSorted('p.votes') %} active{% endif %}"> {{ knp_pagination_sortable(pagination, 'Votes', 'p.votes') }}</span>
            </div>
        </div><!-- /.col-lg-6 -->
        <div class="col-lg-4">
            <form method="GET">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Zoek naar..." name="value" value="{{ app.request.query.get('value') }}">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="submit">Zoeken</button>
                    </span>
                </div><!-- /input-group -->
            </form>
        </div>
        <div class="col-lg-2">
            <div class="pull-right">
                <a href="{{ path('post_new') }}" class="btn btn-primary">Post toevoegen</a>
            </div>
        </div><!-- /.col-lg-6 -->
    </div><!-- /.row -->

    <div class="row">
        <div class="col-lg-12">
            <table class="table table-hover table-reddit">
                {% for post in pagination %}
                    {% set queryData = queryData|merge({'id': post.id}) %}
                    <tr {% if loop.index is odd %}class="color"{% endif %}>
                        <td class="text-center voter-wrapper">
                            <a class="voter {% if app.request.cookies.get(post.getHash()) == 1 %}active{% endif %}" {% if app.request.cookies.get(post.getHash()) != 1 %}href="{{ path('post_upvote', queryData) }}"{% endif %}>
                                <span class="glyphicon glyphicon-arrow-up"></span>
                            </a>
                            <div class="score">{{ post.votes }}</div>
                            <a class="voter {% if app.request.cookies.get(post.getHash()) == -1 %}active{% endif %}" {% if app.request.cookies.get(post.getHash()) != -1 %}href="{{ path('post_downvote', queryData) }}"{% endif %}>
                                <span class="glyphicon glyphicon-arrow-down"></span>
                            </a>
                        </td>
                        <td>
                            <a href="{{ post.url }}" target="_blank"><h3>{{ post.title }} {% if post.writtenAt %}({{ post.writtenAt | date('d-m-Y') }}){% endif %}</h3></a>
                            <small>
                                Toegevoegd op {{ post.createdAt | date('d-m-Y') }}
                                {% for tag in post.tags %}
                                    {% if loop.first %} - {% endif %}
                                    <a href="{{ path('post_index', {'value': tag.name}) }}" class="label label-primary">{{ tag }}</a>
                                {% endfor %}
                            </small>
                        </td>
                        <td class="actions text-right">
                            <a href="{{ path('post_edit', {'id': post.id}) }}"><small class="glyphicon glyphicon-pencil"></small></a>
                            <a data-url="{{ path('post_delete', {'id': post.id}) }}" class="js-modal-toggle" data-toggle="modal" data-target="#confirmDelete" data-title="Delete post" data-message="Ben je zeker dat je deze post wil verwijderen?">
                                <small class="glyphicon glyphicon-trash"></small>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="navigation">
        {{ knp_pagination_render(pagination) }}
    </div>

    {% if not app.request.cookies.has('subscribed') %}

    <div class="row margin-20">
        <div class="col-lg-offset-6 col-lg-6">
        {{ form_start(subscribeForm, {'action': path('subscriber_new')}) }}
            <div class="input-group">
                {{ form_widget(subscribeForm.email, {'attr': {'placeholder': 'Schrijf je hier in voor onze wekelijkse mail'}}) }}
                <span class="input-group-btn">
                    <input class="btn btn-primary" type="submit" value="Subscribe" />
                </span>
            </div>
            {{ form_rest(subscribeForm) }}
        {{ form_end(subscribeForm) }}
        </div>
    </div>

    {% endif %}
{% endblock %}
